<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DataMart Clone</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Segoe UI;background:#f4f6f8;margin:0}
header{background:#fff;padding:15px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 5px rgba(0,0,0,.1)}
nav a{margin-left:10px;text-decoration:none;color:#004d40;font-weight:bold}
.container{max-width:1000px;margin:auto;padding:20px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px}
.card{background:#fff;padding:15px;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,.05);text-align:center}
.card img{width:60px}
button{padding:8px 12px;border:none;border-radius:6px;background:#004d40;color:#fff;cursor:pointer}
button.danger{background:#d32f2f}
button.warn{background:#fbc02d;color:#333}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{padding:10px;border-bottom:1px solid #ddd}
.hidden{display:none}
.copy{color:blue;cursor:pointer;text-decoration:underline}
.badge{padding:4px 8px;border-radius:4px;font-size:12px}
.ok{background:#e8f5e9;color:#2e7d32}
.pending{background:#fff3e0;color:#ef6c00}
</style>
</head>

<body>

<header>
<h2>DataMart</h2>
<nav>
<a href="#" onclick="show('shop')">Shop</a>
<a href="#" onclick="show('cart')">Cart (<span id="cartCount">0</span>)</a>
<a href="#" onclick="show('admin')">Admin</a>
<a href="#" onclick="logout()">Logout</a>
</nav>
</header>

<div class="container">

<!-- LOGIN -->
<div id="login">
<h3>Login</h3>
<input id="phone" placeholder="Phone"><br><br>
<input id="pass" type="password" placeholder="Password"><br><br>
<button onclick="login()">Login</button>
<p>
Admin: 0549399614 / admin<br>
User: 0500000000 / 123
</p>
</div>

<!-- SHOP -->
<div id="shop" class="hidden">
<h3>Welcome <span id="uname"></span> | Balance ₵<span id="ubal"></span></h3>
<div class="grid" id="products"></div>
</div>

<!-- CART -->
<div id="cart" class="hidden">
<h3>Your Cart</h3>
<div id="cartItems"></div>
<h3 id="total"></h3>

<h4>Payment</h4>
<p>MTN: <span class="copy" onclick="copy('0549399614')">0549399614</span> (Marian Korneh)</p>
<p>Telecel: <span class="copy" onclick="copy('0509567822')">0509567822</span> (Susana Nkansah Acquah)</p>

<button onclick="checkout()">Checkout</button>
<p id="ref"></p>
</div>

<!-- ADMIN -->
<div id="admin" class="hidden">
<h2>Admin Dashboard</h2>

<h3>Orders</h3>
<table>
<thead><tr><th>Ref</th><th>User</th><th>Total</th><th>Status</th><th>Action</th></tr></thead>
<tbody id="orders"></tbody>
</table>

<h3>Products</h3>
<input id="pname" placeholder="Name">
<input id="pprice" placeholder="Price">
<button onclick="addProduct()">Add</button>

<table>
<thead><tr><th>Name</th><th>₵</th><th>Action</th></tr></thead>
<tbody id="plist"></tbody>
</table>

<h3>Users</h3>
<table>
<thead><tr><th>Name</th><th>Phone</th><th>₵</th><th>Action</th></tr></thead>
<tbody id="ulist"></tbody>
</table>
</div>

</div>

<script>
// ---------- SEED DATA ----------
if(!localStorage.users){
localStorage.users=JSON.stringify([
{id:1,name:"Admin",phone:"0549399614",password:"admin",role:"admin",balance:1000,suspended:false},
{id:2,name:"Customer",phone:"0500000000",password:"123",role:"user",balance:50,suspended:false}
]);
}
if(!localStorage.products){
localStorage.products=JSON.stringify([
{id:1,name:"MTN 1GB",price:5,logo:"https://upload.wikimedia.org/wikipedia/commons/9/93/New-mtn-logo.jpg",suspended:false},
{id:2,name:"Telecel 2GB",price:10,logo:"https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Vodafone_2017_logotype.svg/2560px-Vodafone_2017_logotype.svg.png",suspended:false}
]);
}
if(!localStorage.orders){localStorage.orders="[]";}
if(!localStorage.cart){localStorage.cart="[]";}

// ---------- GLOBAL ----------
let user=null;

// ---------- AUTH ----------
function login(){
const users=JSON.parse(localStorage.users);
user=users.find(u=>u.phone==phone.value && u.password==pass.value);
if(!user)return alert("Invalid login");
localStorage.currentUser=JSON.stringify(user);
init();
}
function logout(){
localStorage.removeItem("currentUser");
location.reload();
}
function init(){
user=JSON.parse(localStorage.currentUser||null);
if(!user)return;
login.style.display="none";
show("shop");
render();
}
init();

// ---------- NAV ----------
function show(id){
["shop","cart","admin"].forEach(x=>document.getElementById(x).classList.add("hidden"));
if(id==="admin" && user.role!=="admin")return alert("Admin only");
document.getElementById(id).classList.remove("hidden");
render();
}

// ---------- SHOP ----------
function render(){
document.getElementById("uname").innerText=user.name;
document.getElementById("ubal").innerText=user.balance.toFixed(2);

const products=JSON.parse(localStorage.products);
productsEl.innerHTML="";
products.filter(p=>!p.suspended).forEach(p=>{
productsEl.innerHTML+=`
<div class="card">
<img src="${p.logo}">
<h4>${p.name}</h4>
<p>₵${p.price}</p>
<button onclick="addCart(${p.id})">Add</button>
</div>`;
});

renderCart();
renderAdmin();
}

const productsEl=document.getElementById("products");

// ---------- CART ----------
function addCart(id){
let c=JSON.parse(localStorage.cart);
c.push(id);
localStorage.cart=JSON.stringify(c);
render();
}
function renderCart(){
let c=JSON.parse(localStorage.cart);
cartCount.innerText=c.length;
cartItems.innerHTML="";
let total=0;
const products=JSON.parse(localStorage.products);
c.forEach((id,i)=>{
let p=products.find(x=>x.id==id);
total+=p.price;
cartItems.innerHTML+=`${p.name} ₵${p.price}
<button class="danger" onclick="remove(${i})">X</button><br>`;
});
totalEl.innerText="Total ₵"+total.toFixed(2);
}
function remove(i){
let c=JSON.parse(localStorage.cart);
c.splice(i,1);
localStorage.cart=JSON.stringify(c);
render();
}
function checkout(){
let c=JSON.parse(localStorage.cart);
if(!c.length)return alert("Empty");
let products=JSON.parse(localStorage.products);
let total=c.reduce((s,id)=>s+products.find(p=>p.id==id).price,0);
let ref="REF-"+Math.floor(Math.random()*1000000);
let orders=JSON.parse(localStorage.orders);
orders.push({ref,userId:user.id,user:user.name,total,status:"Pending",items:c});
localStorage.orders=JSON.stringify(orders);
localStorage.cart="[]";
document.getElementById("ref").innerText="Reference: "+ref;
render();
}
function copy(n){navigator.clipboard.writeText(n);alert("Copied");}

// ---------- ADMIN ----------
function renderAdmin(){
if(user.role!=="admin")return;

let orders=JSON.parse(localStorage.orders);
ordersEl.innerHTML="";
orders.forEach(o=>{
ordersEl.innerHTML+=`
<tr>
<td>${o.ref}</td>
<td>${o.user}</td>
<td>₵${o.total}</td>
<td><span class="badge ${o.status=="Verified"?"ok":"pending"}">${o.status}</span></td>
<td>${o.status=="Pending"?`<button onclick="verify('${o.ref}')">Verify</button>`:""}</td>
</tr>`;
});

let products=JSON.parse(localStorage.products);
plist.innerHTML="";
products.forEach((p,i)=>{
plist.innerHTML+=`
<tr>
<td>${p.name}</td>
<td>${p.price}</td>
<td>
<button onclick="editProduct(${i})">Edit</button>
<button class="warn" onclick="toggleProduct(${i})">${p.suspended?"Unsuspend":"Suspend"}</button>
<button class="danger" onclick="delProduct(${i})">Delete</button>
</td></tr>`;
});

let users=JSON.parse(localStorage.users);
ulist.innerHTML="";
users.forEach((u,i)=>{
ulist.innerHTML+=`
<tr>
<td>${u.name}</td>
<td>${u.phone}</td>
<td>${u.balance}</td>
<td>
<button onclick="topup(${i})">Top-up</button>
<button class="warn" onclick="toggleUser(${i})">${u.suspended?"Unsuspend":"Suspend"}</button>
</td></tr>`;
});
}

function verify(r){
let orders=JSON.parse(localStorage.orders);
let users=JSON.parse(localStorage.users);
let o=orders.find(x=>x.ref==r);
let u=users.find(x=>x.id==o.userId);
if(u.balance<o.total)return alert("Insufficient balance");
u.balance-=o.total;
o.status="Verified";
localStorage.orders=JSON.stringify(orders);
localStorage.users=JSON.stringify(users);
render();
}

function addProduct(){
let products=JSON.parse(localStorage.products);
products.push({id:Date.now(),name:pname.value,price:+pprice.value,logo:"https://placehold.co/100",suspended:false});
localStorage.products=JSON.stringify(products);
render();
}

function editProduct(i){
let products=JSON.parse(localStorage.products);
products[i].price=+prompt("New price",products[i].price);
localStorage.products=JSON.stringify(products);
render();
}
function toggleProduct(i){
let products=JSON.parse(localStorage.products);
products[i].suspended=!products[i].suspended;
localStorage.products=JSON.stringify(products);
render();
}
function delProduct(i){
let products=JSON.parse(localStorage.products);
products.splice(i,1);
localStorage.products=JSON.stringify(products);
render();
}
function toggleUser(i){
let users=JSON.parse(localStorage.users);
users[i].suspended=!users[i].suspended;
localStorage.users=JSON.stringify(users);
render();
}
function topup(i){
let users=JSON.parse(localStorage.users);
users[i].balance+=+prompt("Amount");
localStorage.users=JSON.stringify(users);
render();
}

</script>
</body>
</html>
